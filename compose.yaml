# Docker Compose configuration for Judo Archive
# Development: uses Air for live reload
# Production: use target: final

services:
  server:
    build:
      context: .
      target: development  # Change to 'final' for production
    ports:
      - 8000:8000
    volumes:
      # Mount source code for live reload
      - .:/app
      # Cache Go modules to avoid re-downloading
      - go-modules:/go/pkg/mod
      # Exclude tmp directory (air builds here)
      - /app/tmp
    environment:
      - GO_ENV=development
    restart: unless-stopped

# Persistent volumes
volumes:
  go-modules:  # Cache Go modules across container rebuilds

# Uncomment below to add PostgreSQL database
#   db:
#     image: postgres:16-alpine
#     restart: always
#     environment:
#       - POSTGRES_DB=judo_archive
#       - POSTGRES_USER=judo
#       - POSTGRES_PASSWORD=judo_password
#     volumes:
#       - db-data:/var/lib/postgresql/data
#     ports:
#       - 5432:5432
#     healthcheck:
#       test: ["CMD", "pg_isready", "-U", "judo"]
#       interval: 10s
#       timeout: 5s
#       retries: 5
#
# volumes:
#   go-modules:
#   db-data:

