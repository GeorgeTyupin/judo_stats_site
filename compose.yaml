# Docker Compose Development Configuration
# Local HTTPS testing with autocert
# For production with real DNS, use: docker compose -f compose.prod.yaml up

services:
  server:
    build:
      context: .
      target: development
    ports:
      - "80:80"      # HTTP (ACME challenge + redirect to HTTPS)
      - "443:443"    # HTTPS
    volumes:
      - .:/app                        # Mount source code for live reload
      - go-modules:/go/pkg/mod        # Cache Go modules
      - /app/tmp                      # Exclude Air build directory
      - certs-cache:/app/certs-cache  # Persistent certificates
    restart: unless-stopped

volumes:
  go-modules:    # Cache Go modules across container rebuilds
  certs-cache:   # TLS certificates cache

# Uncomment below to add PostgreSQL database
#   db:
#     image: postgres:16-alpine
#     restart: always
#     environment:
#       - POSTGRES_DB=judo_archive
#       - POSTGRES_USER=judo
#       - POSTGRES_PASSWORD=judo_password
#     volumes:
#       - db-data:/var/lib/postgresql/data
#     ports:
#       - 5432:5432
#     healthcheck:
#       test: ["CMD", "pg_isready", "-U", "judo"]
#       interval: 10s
#       timeout: 5s
#       retries: 5
#
# volumes:
#   go-modules:
#   db-data:

